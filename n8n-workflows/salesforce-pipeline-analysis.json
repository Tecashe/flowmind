{
  "name": "FlowMind - Salesforce Pipeline Analysis",
  "nodes": [
    {
      "parameters": {
        "resource": "lead",
        "operation": "getAll",
        "returnAll": true,
        "options": {}
      },
      "id": "fetch-leads",
      "name": "Fetch Salesforce Leads",
      "type": "n8n-nodes-base.salesforce",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "resource": "opportunity",
        "operation": "getAll",
        "returnAll": true,
        "options": {}
      },
      "id": "fetch-opportunities",
      "name": "Fetch Opportunities",
      "type": "n8n-nodes-base.salesforce",
      "typeVersion": 1,
      "position": [250, 500]
    },
    {
      "parameters": {
        "jsCode": "// FlowMind AI Sales Process Analysis\nconst leads = $input.first().json;\nconst opportunities = $input.last().json;\n\n// Analyze lead-to-opportunity conversion patterns\nconst conversionAnalysis = {\n  totalLeads: leads.length,\n  totalOpportunities: opportunities.length,\n  conversionRate: (opportunities.length / leads.length) * 100,\n  avgDealSize: opportunities.reduce((sum, opp) => sum + (opp.Amount || 0), 0) / opportunities.length,\n  pipelineHealth: 'Good'\n};\n\n// Identify process bottlenecks\nconst stageAnalysis = {};\nopportunities.forEach(opp => {\n  const stage = opp.StageName;\n  if (!stageAnalysis[stage]) {\n    stageAnalysis[stage] = { count: 0, totalValue: 0, avgDays: 0 };\n  }\n  stageAnalysis[stage].count++;\n  stageAnalysis[stage].totalValue += opp.Amount || 0;\n});\n\n// Generate AI insights\nconst insights = {\n  processEfficiency: conversionAnalysis.conversionRate > 20 ? 'High' : 'Needs Improvement',\n  recommendations: [\n    conversionAnalysis.conversionRate < 15 ? 'Improve lead qualification process' : null,\n    'Automate follow-up sequences for better conversion',\n    'Implement lead scoring for priority handling'\n  ].filter(Boolean),\n  bottlenecks: Object.entries(stageAnalysis)\n    .filter(([stage, data]) => data.count > opportunities.length * 0.3)\n    .map(([stage]) => `High volume in ${stage} stage`),\n  predictedRevenue: Object.values(stageAnalysis).reduce((sum, data) => sum + data.totalValue, 0)\n};\n\nreturn [{\n  json: {\n    analysis: conversionAnalysis,\n    stageBreakdown: stageAnalysis,\n    aiInsights: insights,\n    timestamp: new Date().toISOString(),\n    source: 'salesforce_pipeline'\n  }\n}];"
      },
      "id": "ai-pipeline-analysis",
      "name": "AI Pipeline Analysis",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [550, 400]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "{{ $env.FLOWMIND_API_URL }}/api/analytics/pipeline",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "analysisData",
              "value": "={{ $json }}"
            },
            {
              "name": "organizationId",
              "value": "{{ $env.FLOWMIND_ORG_ID }}"
            }
          ]
        }
      },
      "id": "save-analysis",
      "name": "Save to FlowMind",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [750, 400]
    },
    {
      "parameters": {
        "channel": "sales-team",
        "text": "📊 **Sales Pipeline Analysis Complete**\n\n🎯 **Key Metrics:**\n• Conversion Rate: {{ $json.analysis.conversionRate.toFixed(1) }}%\n• Pipeline Value: ${{ $json.analysis.predictedRevenue.toLocaleString() }}\n• Process Efficiency: {{ $json.aiInsights.processEfficiency }}\n\n💡 **AI Recommendations:**\n{{ $json.aiInsights.recommendations.map(r => `• ${r}`).join('\\n') }}\n\n⚠️ **Bottlenecks Identified:**\n{{ $json.aiInsights.bottlenecks.map(b => `• ${b}`).join('\\n') }}",
        "otherOptions": {}
      },
      "id": "notify-team",
      "name": "Notify Sales Team",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 1,
      "position": [950, 400]
    }
  ],
  "connections": {
    "Fetch Salesforce Leads": {
      "main": [
        [
          {
            "node": "AI Pipeline Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Opportunities": {
      "main": [
        [
          {
            "node": "AI Pipeline Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Pipeline Analysis": {
      "main": [
        [
          {
            "node": "Save to FlowMind",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save to FlowMind": {
      "main": [
        [
          {
            "node": "Notify Sales Team",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "timezone": "America/New_York",
    "executionOrder": "v1"
  },
  "versionId": "1.0.0"
}